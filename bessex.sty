\RequirePackage{hyperref}
% hyperref style prefs
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
    pdfpagemode=FullScreen,
}

\RequireXeTeX

\RequirePackage[usenames,dvipsnames]{color}
\RequirePackage{listings,lstautogobble}

%%%%%%%%%%%%%% Setting up font preferences %%%%%%%%%%%%%%%%
\RequirePackage{fontspec}
\setmonofont{Fira Code}[ % Fira code for mono
  Contextuals=Alternate  % Activate the calt feature
]
\RequirePackage{lstfiracode} % https://ctan.org/pkg/lstfiracode
\newcommand{\zsh}[1]{\lstinline[style=ayu_l,language=Bash]{#1}}
\ActivateVerbatimLigatures

\RequirePackage{inter} % Use Inter as Sans Serif font
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Ayu Light Colors (https://github.com/ayu-theme/ayu-colors/blob/master/src/light.ts)
\definecolor{ayu_l_bg}{rgb}{0.984, 0.984, 0.984}
\definecolor{ayu_l_number}{rgb}{0.637, 0.476, 0.797}
\definecolor{ayu_l_keyword}{rgb}{0.98, 0.557, 0.243}
\definecolor{ayu_l_string}{rgb}{0.523, 0.699, 0}
\definecolor{ayu_l_comment}{rgb}{0.471, 0.48, 0.502}

%Code listing style named "mystyle"
\lstdefinestyle{ayu_l}{
  backgroundcolor=\color{ayu_l_bg}, 
  commentstyle=\color{ayu_l_comment},
  keywordstyle=\color{ayu_l_keyword},
  numberstyle=\ttfamily\tiny\color{ayu_l_comment},
  stringstyle=\color{ayu_l_string},
  basicstyle=\ttfamily\fontsize{8}{14}\selectfont,
  breakatwhitespace=false,
  breaklines=true,
  postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}        
  captionpos=b,                    
  keepspaces=true,                 
  numbers=left,                    
  numbersep=5pt,                  
  showspaces=false,                
  showstringspaces=false,
  showtabs=false,                  
  tabsize=2
}

% Color Numbers
\lstset
{
    literate=%
    {0}{{{\color{ayu_l_number}0}}}1
    {1}{{{\color{ayu_l_number}1}}}1
    {2}{{{\color{ayu_l_number}2}}}1
    {3}{{{\color{ayu_l_number}3}}}1
    {4}{{{\color{ayu_l_number}4}}}1
    {5}{{{\color{ayu_l_number}5}}}1
    {6}{{{\color{ayu_l_number}6}}}1
    {7}{{{\color{ayu_l_number}7}}}1
    {8}{{{\color{ayu_l_number}8}}}1
    {9}{{{\color{ayu_l_number}9}}}1
}

% ayu light code listing set, Python
% \lstset{style=ayu_l,language=Python}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% This code creates an isomapsto arrow \isomarrow %%%%%
% \RequirePackage[utf8]{inputenc}
% \RequirePackage[T1]{fontenc}
% \RequirePackage{lmodern}%
% \RequirePackage{old-arrows}
% \RequirePackage[usestackEOL]{stackengine}
% \newcommand{\isomarrow}{\mathrel{\setstackgap{S}{-0.5pt}\ensurestackMath{\Shortstack{\scriptstyle\sim\\ \longrightarrow}}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% Here are some packages I like to use %%%%
\RequirePackage{mathtools} % used for \coloneqq
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% https://tex.stackexchange.com/questions/340700/ipython-notebook-input-and-output-cells-with-listings

\RequirePackage[most]{tcolorbox}


\definecolor{white}{rgb}{1,1,1}
\definecolor{mygreen}{rgb}{0.031,0.49,0.086}
\definecolor{light_gray}{rgb}{0.968,0.968,0.968}
\definecolor{mykey}{rgb}{0.004,0.2,0.702}

\tcbuselibrary{listings}
\newlength\inwd
\setlength\inwd{1.3cm}

\newcounter{ipythcntr}
\renewcommand{\theipythcntr}{\texttt{[\arabic{ipythcntr}]}}

\newtcblisting{pyin}[1][]{%
  sharp corners,
  enlarge left by=\inwd,
  width=\linewidth-\inwd,
  enhanced,
  boxrule=0pt,
  colback=light_gray,
  listing only,
  top=0pt,
  bottom=0pt,
  overlay={
    \node[
      anchor=north east,
      text width=\inwd,
      font=\footnotesize\ttfamily\color{mykey},
      inner ysep=2mm,
      inner xsep=0pt,
      outer sep=0pt
      ] 
      at (frame.north west)
      {\refstepcounter{ipythcntr}\label{#1}In \theipythcntr:};
  }
  listing engine=listing,
  listing options={
    aboveskip=1pt,
    belowskip=1pt,
    basicstyle=\ttfamily\fontsize{8}{14}\selectfont,
    language=Python,
    keywordstyle=\color{mykey},
    commentstyle=\color{ayu_l_comment},
    showstringspaces=false,
    stringstyle=\color{mygreen},
    breaklines=true,
    postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}
  },
}
\newtcblisting{pyprint}{
  sharp corners,
  enlarge left by=\inwd,
  width=\linewidth-\inwd,
  enhanced,
  boxrule=0pt,
  colback=white,
  listing only,
  top=0pt,
  bottom=0pt,
  overlay={
    \node[
      anchor=north east,
      text width=\inwd,
      font=\footnotesize\ttfamily\color{mykey},
      inner ysep=2mm,
      inner xsep=0pt,
      outer sep=0pt
      ] 
      at (frame.north west)
      {};
  }
  listing engine=listing,
  listing options={
      aboveskip=1pt,
      belowskip=1pt,
      basicstyle=\ttfamily\fontsize{8}{14}\selectfont,,
      language=Python,
      keywordstyle=\color{mykey},
      commentstyle=\color{ayu_l_comment},
      showstringspaces=false,
      stringstyle=\color{mygreen},
      breaklines=true,
      postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}
    },
}
\newtcblisting{pyout}[1][\theipythcntr]{
  sharp corners,
  enlarge left by=\inwd,
  width=\linewidth-\inwd,
  enhanced,
  boxrule=0pt,
  colback=white,
  listing only,
  top=0pt,
  bottom=0pt,
  overlay={
    \node[
      anchor=north east,
      text width=\inwd,
      font=\footnotesize\ttfamily\color{mykey},
      inner ysep=2mm,
      inner xsep=0pt,
      outer sep=0pt
      ] 
      at (frame.north west)
      {\setcounter{ipythcntr}{\value{ipythcntr}}Out#1:};
  }
  listing engine=listing,
  listing options={
      aboveskip=1pt,
      belowskip=1pt,
      basicstyle=\ttfamily\fontsize{8}{14}\selectfont,
      language=Python,
      keywordstyle=\color{mykey},
      commentstyle=\color{ayu_l_comment},
      showstringspaces=false,
      stringstyle=\color{mygreen},
      breaklines=true,
      postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}
    },
}